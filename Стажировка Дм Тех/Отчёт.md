# Отчет ДМ-тех (Финальная версия)

## Задание 1 — Чек-лист проверок для страницы "карточка товара"

Для тестирования была использована страница товара: **конструктор LEGO 42158 «NASA Mars Rover»**.
**URL:** https://www.detmir.ru/product/index/id/3366470/

| №  | Название проверки | Уровень | Комментарий / ожидаемый результат |
|----|--------------------|---------|-------------------------------------|
| 1  | Открытие страницы без ошибок в консоли | UI | 200 OK, нет 4xx/5xx, нет JS-error |
| 2  | Хлебные крошки | UI | Главная › Каталог › Игрушки › Конструкторы › LEGO › Текущий товар |
| 3  | Название товара | UI | LEGO 42158 «NASA Mars Rover Perseverance» |
| 4  | Артикул / код | UI | Присутствует и совпадает с 42158 |
| 5  | Бренд | UI | LEGO |
| 6  | Возрастные ограничения | UI | 9+ |
| 7  | Наличие (кнопка «В корзину») | UI | Кнопка активна, текст «В корзину» |
| 8  | Цена | UI | Отображается рубль, копейки, нет «null» |
| 9  | Старая цена + скидка | UI | Если есть акция – перечеркнутая цена и % скидки |
|10  | Фото-галерея | UI | ≥1 фото, листается, зум работает |
|11  | Видео (если есть) | UI | Проигрывается без ошибок |
|12  | Описание | UI | Текст без «Lorem ipsum», нет orphan-символов |
|13  | Характеристики | UI | Кол-во деталей 1132, страна производства и т.д. |
|14  | Состав комплекта | UI | Перечень пакетов/наклеек |
|15  | Отзывы | UI | Блок отзывов открывается, счётчик ≥0 |
|16  | Рейтинг | UI | Звёзды закрашены, значение 0-5 |
|17  | Кнопка «В избранное» | UI | Сердечко кликабельно, меняет состояние |
|18  | Кнопка «Поделиться» | UI | Появляются соц-сети/ссылка |
|19  | Доставка – блок «Где доставить» | UI | Выпадает список городов, выбор сохраняется |
|20  | Сроки доставки | UI | Указаны дни, нет «undefined» |
|21  | Самовывоз | UI | Пункты выдачи отображаются на карте |
|22  | Кол-во товара (stepper) | UI | +/- увеличивают/уменьшают, поле ввода 1-99 |
|23  | Добавление в корзину | Func | После нажатия кнопка становится «В корзине», счётчик корзины +1 |
|24  | Лимит товара | Func | При попытке добавить >99 появляется тост «Максимум 99 шт» |
|25  | Пустая корзина | Func | Если товар уже был, повторное нажатие не дублирует строку, а увеличивает qty |
|26  | Быстрая покупка (купить в 1 клик) | Func | Открывается поп-ап, заполняется телефон |
|27  | Рекомендации «С этим товаром покупают» | UI | Горизонтальный скролл, карточки кликабельны |
|28  | SEO-разметка | SEO | title, h1, description заполнены, без «undefined» |
|29  | Микроразметка Schema.org | SEO | JSON-LD › Product присутствует |
|30  | 404 если товар не существует | Func | Подставить /product/index/id/999999999 → 404 |
|31  | Desktop 1920 | UI | Без горизонтального скролла |
|32  | Tablet 768 | UI | Галерея свайп, кнопки не уезжают |
|33  | Mobile 375 | UI | Кнопка «В корзину» фиксирована внизу |
|34  | Accessibility | A11y | alt у картинок, кнопки читаемы скрин-ридером |
|35  | Время отклика | Perf | TTI ≤3 с на 3G |

---

## Задание 2 — Тест-кейс для авторизации

**Тест-кейс: AUTH-1 — Успешная авторизация по magic-ссылке на почте**

**Предусловие:** У пользователя есть валидный аккаунт, привязанный к email.

| Шаг | Действие | Ожидаемый результат |
|-----|----------|---------------------|
| 1 | Открыть https://www.detmir.ru/ | Открывается главная страница |
| 2 | Кликнуть «Войти» (иконка человечка) | Открывается модальное окно авторизации |
| 3 | Выбрать способ «По email» | Отображается поле для ввода email |
| 4 | Ввести email: `testqa@example.com` | Email принят, ошибок валидации нет |
| 5 | Нажать «Получить ссылку» | Появляется уведомление о отправке ссылки |
| 6 | Перейти в почтовый ящик | Открывается почтовый клиент |
| 7 | Открыть письмо «Вход в Детский мир» | Письмо содержит кнопку «Войти» |
| 8 | Кликнуть кнопку «Войти» в письме | Происходит редирект на сайт |

**Ожидаемый результат после выполнения всех шагов:**
1.  Открывается главная страница.
2.  В хедере отображается имя пользователя.
3.  В куках появляется JWT-токен `auth_token` (HttpOnly, Secure).
4.  При переходе в «Личный кабинет» отображаются заказы и бонусы.

**Постусловие:** Нажать «Выйти» → куки удаляются, кнопка «Войти» снова активна.

---

## Задание 3 — REST запросы

### a) GET запрос для получения информации о товаре

Этот запрос выполняется успешно и служит основой для дальнейших действий.

**Метод:** GET
**URL:** `https://api.detmir.ru/v2/products/3192878`

**Заголовки:**
```
User-Agent: Postman
Accept: application/json
```

**Ожидаемый ответ:** Status 200 OK
```json
{
  "id": 3192878,
  "name": "Конструктор LEGO 42100 Technic Liebherr R 9800",
  "price": { "current": 399990, "currency": "RUB" },
  "stock": { "available": true, "qty": 17 }
}
```

---

### b) PUT запрос для добавления товара в корзину (Рабочий вариант)

В результате детального анализа сетевого трафика и последующего тестирования был составлен корректный запрос.

**Демонстрация рабочего запроса:**
Вы можете посмотреть полностью рабочий запрос, включая все заголовки, тело и ответ, по этой ссылке:
**[https://martian-crater-291260.postman.co/workspace/Стажировка~a87108e6-0167-45f0-bdaf-2d8a509731ad/request/43345427-eff66cd5-6705-41d1-b065-e89c6360fdd3?action=share&creator=43345427](https://martian-crater-291260.postman.co/workspace/%D0%A1%D1%82%D0%B0%D0%B6%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0~a87108e6-0167-45f0-bdaf-2d8a509731ad/request/43345427-eff66cd5-6705-41d1-b065-e89c6360fdd3?action=share&creator=43345427)**

**Ключевые параметры рабочего запроса:**

*   **Метод:** `PUT`
*   **URL:** `https://api.detmir.ru/v4/carts/mini/item/3192878?hybrisCuid={{cart_id}}&minOrderQuantity=true&serviceFee=true&instoreNearestInterval=true&reqAddress=2`
*   **Заголовки:**
    *   `Content-Type: application/json`
    *   `x-csrf-token: {{csrf_token}}`
    *   `Cookie: {{session_cookies}}`
*   **Тело запроса (JSON):**
    ```json
    {
      "quantity": 3
    }
    ```
*   **Ожидаемый ответ:** Status `200 OK` с телом, подтверждающим успешное добавление.

---

### Объяснение ошибки 404 и анализ

Первоначальный запрос `POST /api/v1/cart/items` возвращал ошибку `404 Not Found`. В ходе расследования было установлено, что реальный API-вызов кардинально отличается:

1.  **Метод:** Сайт использует `PUT` для добавления/обновления товара, а не `POST`.
2.  **Версия API:** Актуальная версия — `v4`, а не `v1`.
3.  **URL эндпоинта:** Правильный путь `/carts/mini/item/{product_id}`, а не `/cart/items`.
4.  **Идентификатор корзины:** В URL необходимо передавать `hybrisCuid` — ID корзины, который берется из cookies.
5.  **Тело запроса:** API ожидает JSON с ключом `quantity`, а не `product_id` в корне объекта.

---

## Задание 4 — SQL запрос

```sql
SELECT *
FROM orders
ORDER BY ord_date ASC,
         purch_amt DESC;
```

**Описание запроса:**
- Выбирает все поля из таблицы `orders`.
- Сортирует результаты по дате заказа (`ord_date`) в порядке возрастания (ASC).
- Внутри одинаковых дат сортирует по сумме заказа (`purch_amt`) в порядке убывания (DESC).

---

Скриншоты с Постмана прилагаются.
